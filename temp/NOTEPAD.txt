// Add New Category POST
const addNewCategory = async (req, res) => {
    try {
        const { name: categoryName } = req.body;

        const existingCategory = await categoryModel.findOne({ categoryName: { $regex: new RegExp('^' + categoryName + '$', 'i') } });

        if (existingCategory) {
            const categoryData = await categoryModel.find();
            return res.render('category', { categoryData, message: 'Category name already exists' });
        }   

        const category = new categoryModel({ categoryName });

        await category.save();
        res.redirect('/admin/category');

    } catch (error) {
        console.error(error);
    }
};

// ADD CATEGORY EJS
<%- include("../layout/adminHeader") %>
<%- include("../layout/adminSidebarHead") %>

<div class="main-panel pt-5">
    <div class="content-wrapper">
      <!-- form to add new product -->
      <div class="col-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Add Category</h4>
            <% if (locals.message) { %>
              <span style="color: red;">
                <%= message %>
              </span>
            <% } %>
            <form id="categoryForm" class="forms-sample" method="post" action="/admin/addNewCategory">
              <div id="validationMessage" style="color: red; display: none;"></div>
              <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" name="name" pattern="[A-Za-z ]+" title="Please enter letters and spaces only" >
              </div>
              <button type="submit" class="btn btn-gradient-success mr-2">Add+</button>
              <button type="button" onclick="location.href='/admin/category'" class="btn btn-light">Cancel</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

<%- include("../layout/adminSidebarFoot") %>
<%- include("../layout/adminFooter") %>

<script>
    document.getElementById('categoryForm').addEventListener('submit', function(event) {
      event.preventDefault();
  
      var nameInput = document.getElementById('name');
      var nameValue = nameInput.value.trim();
  
      nameInput.value = nameValue;
  
      var validationMessage = document.getElementById('validationMessage');
      validationMessage.style.display = 'none';
      validationMessage.innerHTML = '';
  
      if (nameValue === '') {
        validationMessage.innerHTML = 'Please enter the category name.';
        validationMessage.style.display = 'block';
        return;
      }
  
      this.submit();
    });
</script>